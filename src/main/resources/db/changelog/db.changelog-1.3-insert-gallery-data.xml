<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="
                     http://www.liquibase.org/xml/ns/dbchangelog
                     http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.17.xsd">

    <changeSet id="1.3.1-insert-artist-profile" author="arina">
        <preConditions onFail="MARK_RAN">
            <tableIsEmpty tableName="artist_profiles"/>
        </preConditions>

        <!--artistProfile for artist-->
        <insert tableName="artist_profiles">
            <column name="user_id" valueComputed="(SELECT id FROM users WHERE username = 'artist')"/>
            <column name="display_name" value="ArtStudio Artist"/>
            <column name="bio" value="An artist specializing in impressionism and landscapes."/>
            <column name="website" value="https://artist.gallery.com"/>
        </insert>

        <rollback>
            <delete tableName="artist_profiles">
                <where>
                    user_id = (SELECT id FROM users WHERE username = 'artist')
                </where>
            </delete>
        </rollback>
    </changeSet>

    <changeSet id="1.3.2-insert-artworks" author="arina">
        <preConditions onFail="MARK_RAN">
            <tableIsEmpty tableName="artworks"/>
        </preConditions>

        <!--1 artwork for artist-->
        <insert tableName="artworks">
            <column name="artist_profile_id"
                    valueComputed="(SELECT id FROM artist_profiles WHERE display_name = 'ArtStudio Artist')"/>
            <column name="title" value="Quiet pond"/>
            <column name="description" value="Oil on canvas"/>
            <column name="artwork_year" value="2024"/>
            <column name="style" value="LANDSCAPE"/>
            <column name="image_path" value="/images/art/quiet_pond_1.jpg"/>
            <column name="is_public" valueBoolean="true"/>
            <column name="created_at" valueComputed="NOW()"/>
        </insert>
        <!--2 artwork for artist-->
        <insert tableName="artworks">
            <column name="artist_profile_id"
                    valueComputed="(SELECT id FROM artist_profiles WHERE display_name = 'ArtStudio Artist')"/>
            <column name="title" value="Urban sunset"/>
            <column name="description" value="Watercolour"/>
            <column name="artwork_year" value="2025"/>
            <column name="style" value="ABSTRACT"/>
            <column name="image_path" value="/images/art/urban_sunset_1.jpg"/>
            <column name="is_public" valueBoolean="true"/>
            <column name="created_at" valueComputed="NOW()"/>
        </insert>
        <rollback>
            <delete tableName="artworks">
                <where>
                    artist_profile_id = (SELECT id FROM artist_profiles
                        WHERE display_name = 'ArtStudio Artist')
                    AND title IN ('Quiet pond', 'Urban sunset')
                </where>
            </delete>
        </rollback>
    </changeSet>

    <changeSet id="1.3.3-insert-reviews" author="arina">
        <preConditions onFail="MARK_RAN">
            <tableIsEmpty tableName="reviews"/>
        </preConditions>

        <!--review for artwork_1-->
        <insert tableName="reviews">
            <column name="artwork_id" valueComputed="(SELECT id FROM artworks WHERE title = 'Quiet pond')"/>
            <column name="author_id" valueComputed="(SELECT id FROM users WHERE username = 'visitor')"/>
            <column name="rating" valueNumeric="5"/>
            <column name="comment" value="Amazing work, very soothing"/>
            <column name="created_at" valueComputed="NOW()"/>
        </insert>
        <!--review for artwork_2-->
        <insert tableName="reviews">
            <column name="artwork_id" valueComputed="(SELECT id FROM artworks WHERE title = 'Urban sunset')"/>
            <column name="author_id" valueComputed="(SELECT id FROM users WHERE username = 'visitor')"/>
            <column name="rating" valueNumeric="4"/>
            <column name="comment" value="Interesting use of color, but a bit dark"/>
            <column name="created_at" valueComputed="NOW()"/>
        </insert>

        <rollback>
            <delete tableName="reviews">
                <where>
                    author_id = (SELECT id FROM users WHERE username = 'visitor') AND
                    artwork_id IN (
                        (SELECT id FROM artworks WHERE title = 'Quiet pond'),
                        (SELECT id FROM artworks WHERE title = 'Urban sunset')
                    )
                </where>
            </delete>
        </rollback>
    </changeSet>

    <changeSet id="1.3.4-insert-exhibition" author="arina">
        <preConditions onFail="MARK_RAN">
            <tableIsEmpty tableName="exhibitions"/>
        </preConditions>

        <insert tableName="exhibitions">
            <column name="title" value="Modern Impressionism: The Echo of Light"/>
            <column name="description"
                    value="This exhibition is a journey into the world of fleeting moments and the play of light."/>
            <column name="start_date" valueDate="2025-12-01"/>
            <column name="end_date" valueDate="2025-12-31"/>
            <column name="curator_id" valueComputed="(SELECT id FROM users WHERE username = 'curator')"/>
            <column name="status" value="PLANNED"/>
        </insert>

        <rollback>
            <delete tableName="exhibitions">
                <where>
                    title = 'Modern Impressionism: The Echo of Light'
                </where>
            </delete>
        </rollback>
    </changeSet>

    <changeSet id="1.3.5-insert-exhibition-artworks" author="arina">
        <preConditions onFail="MARK_RAN">
            <tableIsEmpty tableName="exhibition_artworks"/>
        </preConditions>

        <!--artwork_1 to an exhibition-->
        <insert tableName="exhibition_artworks">
            <column name="exhibition_id"
                    valueComputed="(SELECT id FROM exhibitions
                    WHERE title = 'Modern Impressionism: The Echo of Light')"/>
            <column name="artwork_id"
                    valueComputed="(SELECT id FROM artworks
                    WHERE title = 'Quiet pond' AND artist_profile_id =
                    (SELECT id FROM artist_profiles WHERE display_name = 'ArtStudio Artist'))"/>
        </insert>
        <!--artwork_2 to an exhibition-->
        <insert tableName="exhibition_artworks">
            <column name="exhibition_id"
                    valueComputed="(SELECT id FROM exhibitions
                    WHERE title = 'Modern Impressionism: The Echo of Light')"/>
            <column name="artwork_id"
                    valueComputed="(SELECT id FROM artworks
                    WHERE title = 'Urban sunset' AND artist_profile_id =
                    (SELECT id FROM artist_profiles WHERE display_name = 'ArtStudio Artist'))"/>
        </insert>

        <rollback>
            <delete tableName="exhibition_artworks">
                <where>
                    exhibition_id = (SELECT id FROM exhibitions
                    WHERE title = 'Modern Impressionism: The Echo of Light')
                </where>
            </delete>
        </rollback>
    </changeSet>

    <changeSet id="1.3.6-insert-invitations" author="arina">
        <preConditions onFail="MARK_RAN">
            <tableIsEmpty tableName="invitations"/>
        </preConditions>

        <insert tableName="invitations">
            <column name="exhibition_id"
                    valueComputed="(SELECT id FROM exhibitions
                    WHERE title = 'Modern Impressionism: The Echo of Light')"/>
            <column name="artist_profile_id"
                    valueComputed="(SELECT id FROM artist_profiles WHERE display_name = 'ArtStudio Artist')"/>
            <column name="status" value="PENDING"/>
            <column name="created_at" valueComputed="NOW()"/>
        </insert>

        <rollback>
            <delete tableName="invitations">
                <where>
                    exhibition_id = (SELECT id FROM exhibitions
                    WHERE title = 'Modern Impressionism: The Echo of Light')
                </where>
            </delete>
        </rollback>
    </changeSet>

</databaseChangeLog>